\hypertarget{timer__proj_8c_source}{}\doxysection{timer\+\_\+proj.\+c}
\label{timer__proj_8c_source}\index{src/devices/timer\_proj.c@{src/devices/timer\_proj.c}}
\mbox{\hyperlink{timer__proj_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00001}00001 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{timer__proj_8h}{timer\_proj.h}}"{}}}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00003}\mbox{\hyperlink{timer__proj_8c_a7f3d11d35385878045b6b6a2ec438ba8}{00003}} \textcolor{keywordtype}{int} \mbox{\hyperlink{timer__proj_8c_a7f3d11d35385878045b6b6a2ec438ba8}{hook\_id\_timer}} = 0;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00004}\mbox{\hyperlink{timer__proj_8c_a710095a2bf72382ba53a623ae8a72b7e}{00004}} \textcolor{keywordtype}{int} \mbox{\hyperlink{timer__proj_8c_a710095a2bf72382ba53a623ae8a72b7e}{timerCount}} = 0;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00005}00005 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00006}\mbox{\hyperlink{timer__proj_8c_a1b7a4bfd53b7d72912eb8f353ef64490}{00006}} uint8\_t (\mbox{\hyperlink{timer__proj_8c_a1b7a4bfd53b7d72912eb8f353ef64490}{timer\_subscribe}})() \{}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00007}00007   uint8\_t bit\_no = BIT(\mbox{\hyperlink{timer__proj_8c_a7f3d11d35385878045b6b6a2ec438ba8}{hook\_id\_timer}});}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00008}00008   }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00009}00009   \textcolor{keywordflow}{if}(sys\_irqsetpolicy(\mbox{\hyperlink{define_8h_ad40cf8f3e7e75d30d8dd9f7b041e6ef7}{TIMER\_IRQ\_LINE}}, IRQ\_REENABLE,\&\mbox{\hyperlink{timer__proj_8c_a7f3d11d35385878045b6b6a2ec438ba8}{hook\_id\_timer}})) \textcolor{keywordflow}{return} 0xFF;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00010}00010 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00011}00011   \textcolor{keywordflow}{return} bit\_no;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00012}00012 \}}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00013}00013 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00014}\mbox{\hyperlink{timer__proj_8c_a9e1f3f8773ad05f253feeda4c9d096e4}{00014}} int (\mbox{\hyperlink{timer__proj_8c_a9e1f3f8773ad05f253feeda4c9d096e4}{timer\_unsubscribe}})() \{}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00015}00015   \textcolor{keywordflow}{return} sys\_irqrmpolicy(\&\mbox{\hyperlink{timer__proj_8c_a7f3d11d35385878045b6b6a2ec438ba8}{hook\_id\_timer}});}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00016}00016 \}}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00018}\mbox{\hyperlink{timer__proj_8c_aa77a834317c7fb674015afb57ce5eee8}{00018}} void (\mbox{\hyperlink{timer__proj_8c_aa77a834317c7fb674015afb57ce5eee8}{timer\_int\_handler\_proj}})() \{}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00019}00019   \mbox{\hyperlink{timer__proj_8c_a710095a2bf72382ba53a623ae8a72b7e}{timerCount}}++;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00020}00020   \mbox{\hyperlink{global_8h_abdd2eef1d70041de463214f2f9469f4d}{counter\_timer}}++;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00021}00021 \}}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00022}00022 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00025}00025 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00026}00026 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00027}00027 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00028}\mbox{\hyperlink{timer__proj_8c_aa99b446b6b765c63b6279d0309f7add6}{00028}} int (\mbox{\hyperlink{timer__proj_8c_aa99b446b6b765c63b6279d0309f7add6}{timer\_set\_frequency\_proj}})(uint8\_t timer, uint32\_t freq) \{}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00029}00029 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00030}00030   uint32\_t st = \mbox{\hyperlink{timer__proj_8c_ae793c0b7886d11d4f4eabd86752922e6}{timer\_get\_config}}(timer);}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00031}00031   \textcolor{keywordflow}{if}(st == 0xFFFF) \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00032}00032   uint8\_t status = (uint8\_t)((st \& 0x0F) | \mbox{\hyperlink{define_8h_a8c0f1933323274c765e23837e4fbc8c7}{TIMER\_LSB\_MSB}}); }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00033}00033 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00034}00034   uint32\_t temp = \mbox{\hyperlink{define_8h_aa4d79080dd64c8164b45202b5fa77424}{CONST\_FREQ}} / freq;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00035}00035   uint8\_t msb = (temp >> 8) \& 0xFF;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00036}00036   uint8\_t lsb = (0xFF \& temp);}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00037}00037   status \&= \string~BIT(6);}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00038}00038   status \&= \string~BIT(7);}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00039}00039   \textcolor{keywordflow}{if}(sys\_outb(\mbox{\hyperlink{define_8h_a300ff385500e663d5280b927366e32d8}{TIMER\_STATUS}}, \mbox{\hyperlink{define_8h_aa129740d09f615ace83f8f0b8bd04e8a}{SELECT\_TIMER}}(timer) | status)) \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00040}00040   \textcolor{keywordflow}{if}(sys\_outb(\mbox{\hyperlink{define_8h_acc9ff9df4a9674a1ce9ba08fc4a4679e}{TIMER\_0}}+timer, lsb)) \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00041}00041   \textcolor{keywordflow}{if}(sys\_outb(\mbox{\hyperlink{define_8h_acc9ff9df4a9674a1ce9ba08fc4a4679e}{TIMER\_0}}+timer, msb)) \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00042}00042   \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00043}00043 \}}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00045}00045 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00046}\mbox{\hyperlink{timer__proj_8c_ae793c0b7886d11d4f4eabd86752922e6}{00046}} uint32\_t \mbox{\hyperlink{timer__proj_8c_ae793c0b7886d11d4f4eabd86752922e6}{timer\_get\_config}}(uint8\_t timer) \{}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00047}00047 }
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00048}00048   \textcolor{keywordflow}{if}(sys\_outb(\mbox{\hyperlink{define_8h_a300ff385500e663d5280b927366e32d8}{TIMER\_STATUS}}, \mbox{\hyperlink{define_8h_a4c2eecbfb96744a9c2af71dba75ecb18}{TIMER\_RB\_CMD}} | \mbox{\hyperlink{define_8h_af0fc596f1b70585784f6b4531762687d}{TIMER\_COUNT\_MODE}} | \mbox{\hyperlink{define_8h_a9bea4f38873ae05747004ac2cce63b35}{SELECT\_RB\_TIMER}}(timer))) \textcolor{keywordflow}{return} 0xFFFF;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00049}00049   uint32\_t status;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00050}00050   \textcolor{keywordflow}{if}(sys\_inb(\mbox{\hyperlink{define_8h_acc9ff9df4a9674a1ce9ba08fc4a4679e}{TIMER\_0}} + timer, \&status)) \textcolor{keywordflow}{return} 0xFFFF;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00051}00051   \textcolor{keywordflow}{return} status;}
\DoxyCodeLine{\Hypertarget{timer__proj_8c_source_l00052}00052 \}}

\end{DoxyCode}
